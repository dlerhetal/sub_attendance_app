workflows:
  ios-build:
    name: iOS Build
    instance_type: mac_mini_m1
    environment:
      flutter: stable
      groups:
        - credentials
    scripts:
      - name: Clean Flutter project
        script: flutter clean
      - name: Create credentials files from environment variables
        script: |
          set -e
          mkdir -p assets
          echo $GOOGLE_CREDENTIALS_JSON > assets/credentials.json
          echo $GOOGLE_CREDENTIALS_JSON > assets/jwenochs-subattendance-0203df541a27.json
      - name: Get Flutter packages
        script: flutter pub get
      - name: Create ExportOptions.plist
        script: |
          cat << EOF > ios/ExportOptions.plist
          <?xml version="1.0" encoding="UTF-8"?>
          <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
          <plist version="1.0">
          <dict>
              <key>method</key>
              <string>app-store</string>
              <key>teamID</key>
              <string>S44UV7KL44</string>
              <key>uploadBitcode</key>
              <false/>
              <key>uploadSymbols</key>
              <true/>
          </dict>
          </plist>
          EOF
      - name: Build iOS app
        script: flutter build ipa --export-options-plist=ios/ExportOptions.plist # Modified
    artifacts:
      - build/ios/ipa/*.ipa

signing:
  ios:
    distribution_type: app_store
    bundle_id: com.dlerhetal.subattendanceapp
    certificate_id: sub_attendance
    provisioning_profile_id: sub_attendance